# 使用指南 / User Guide

## 功能演示说明 / Feature Demonstration Guide

本指南说明如何使用新实现的乘客管理和连续扫码功能。

---

## 一、乘客管理功能 / Passenger Management

### 1. 访问管理界面 / Access Admin Panel

1. 使用管理员账号登录
   - OpenID 格式: `admin_*` (例如: `admin_test`)
2. 点击顶部导航栏的 **"用户管理"** 标签

### 2. 查看乘客列表 / View Passenger List

在用户管理界面，你会看到两个表格：
- **乘客列表** - 显示所有已注册乘客
- **系统用户列表** - 显示所有系统用户（管理员、司机等）

乘客列表包含以下信息：
- 姓名
- 公司
- 职位
- 手机号
- 状态（活跃/停用）

### 3. 添加新乘客 / Add New Passenger

1. 点击 **"添加新用户"** 按钮
2. 在弹出的表单中：
   - **角色**: 选择 "乘客"
   - **姓名**: 输入乘客姓名（必填）
   - **手机号码**: 输入11位手机号（必填）
   - **所属公司**: 输入公司名称（可选）
   - **职位**: 输入职位（可选）
3. 点击 **"确认添加"** 按钮
4. 系统会显示成功提示，乘客列表会自动刷新

### 4. 预置乘客 / Pre-configured Passenger

数据库迁移已自动添加以下乘客：
```
姓名: 陈子瑜
公司: 厦门轨道集团商业物业公司
职位: 经理
手机: 18559279970
```

---

## 二、司机连续扫码功能 / Driver Continuous Scanning

### 1. 进入扫码界面 / Enter Scanning Mode

1. 使用司机账号登录
   - OpenID 格式: `driver_*` (例如: `driver_test`)
2. 点击页面底部的 **"开启扫码核验·扫描"** 按钮
3. 允许浏览器访问摄像头（首次使用时）

### 2. 连续扫码模式 / Continuous Scanning Mode

进入扫码界面后：
- 顶部显示 **"核验通道已开启 (连续扫码模式)"**
- 扫描框中心有四个蓝色角框
- 扫描线在框内上下移动

### 3. 扫码验证 / Scan Verification

#### 成功验证 (Success):
1. 扫描有效的乘客二维码
2. **视觉反馈**:
   - 扫描框和扫描线变为**绿色**
   - 框体短暂**闪烁**（0.5秒）
   - 顶部显示**绿色浮动提示**
3. **提示信息**: "✓ 验证成功: [乘客姓名] ([公司])"
4. **自动恢复**: 1.5秒后自动返回扫描状态，准备扫描下一个

#### 失败验证 (Failure):
1. 扫描无效/过期的二维码
2. **视觉反馈**:
   - 扫描框和扫描线变为**红色**
   - 框体短暂**闪烁**（0.5秒）
   - 顶部显示**红色浮动提示**
3. **提示信息**: "✗ 验证失败: [错误原因]"
4. **自动恢复**: 2秒后自动返回扫描状态

### 4. 连续扫码优势 / Continuous Scanning Benefits

- ✅ **无需重复操作** - 扫码后不关闭扫描器
- ✅ **快速识别** - 绿/红闪烁让司机一眼看出结果
- ✅ **详细信息** - 显示乘客姓名和公司
- ✅ **高效核验** - 适合高峰期快速验证多个乘客

### 5. 退出扫码 / Exit Scanning

点击左上角的 **×** 按钮关闭扫描器

---

## 三、演示模式说明 / Demo Mode Notes

在演示环境中，由于没有实际的二维码扫描库：
1. 点击视频区域会弹出输入框
2. 输入乘客的票据ID（ticket ID）
3. 系统会模拟扫码验证流程

在生产环境中，这会被替换为实际的QR码扫描库（如 `jsQR` 或 `html5-qrcode`）。

---

## 四、技术细节 / Technical Details

### 视觉反馈动画

#### 绿色闪烁 (Green Flash)
```css
@keyframes flash-green {
  0% { opacity: 0; }
  50% { opacity: 1; }
  100% { opacity: 0; }
}
```

#### 红色闪烁 (Red Flash)
```css
@keyframes flash-red {
  0% { opacity: 0; }
  50% { opacity: 1; }
  100% { opacity: 0; }
}
```

### 状态转换流程

```
开启扫码 → 扫描状态 (scanning)
              ↓
          检测到二维码
              ↓
      调用验证API (/api/tickets/verify)
              ↓
         ┌────┴────┐
         ↓         ↓
      成功       失败
    (success)  (error)
         ↓         ↓
    绿色闪烁    红色闪烁
    显示提示    显示错误
         ↓         ↓
    1.5秒后    2秒后
         ↓         ↓
         └────┬────┘
              ↓
        返回扫描状态
        (继续扫描)
```

---

## 五、故障排查 / Troubleshooting

### 问题: 摄像头无法启动
**解决方案**:
- 检查浏览器摄像头权限设置
- 确保使用HTTPS连接（或localhost）
- 尝试使用不同的浏览器

### 问题: 扫码后没有反应
**解决方案**:
- 检查网络连接
- 确认二维码是否有效
- 查看浏览器控制台日志

### 问题: 乘客列表为空
**解决方案**:
- 确认已运行数据库迁移
- 检查数据库连接
- 确认使用管理员账号登录

---

## 六、性能优化建议 / Performance Tips

1. **连续扫码时**: 建议使用性能较好的设备，确保流畅体验
2. **乘客列表**: 如果乘客数量很多，考虑添加分页功能
3. **摄像头**: 使用环境光充足的场所，提高扫码成功率

---

需要帮助？请联系技术支持团队。
Need help? Please contact the technical support team.
